{% extends "layout.html" %}

{% block css %}
<link rel="stylesheet" href="/club/stylesheets/club.css" />
{% endblock %}

{% block content %}
<section class="feed-container">
  <header class="feed-header">
    <h1 class="feed-title">도전 클럽</h1>
    <div class="fake_field">
      <form id="hashtag-form" action="/club/hashtag">
        <input class="tag-search" type="text" name="hashtag" placeholder="태그 검색">
        <button class="tag-search-btn btn" type="submit"><i class="fas fa-search"></i></button>
      </form>
    </div>
  </header>
  <div class="feed-body">
    {% if user and user.id %}
    <button id="feed-btn" class="uploads-btn" type="submit" class="black btn">
      <a class="picture-uploads" href="/clubupload"><i class="fas fa-file-upload"></i></a>
    </button>
    {% endif %}
    {% for twit in twits %}
    <div class="twit">
      <input type="hidden" value="{{twit.User.id}}" class="twit-user-id" />
      <input type="hidden" value="{{twit.id}}" class="twit-id" />
      <div class="twit-author">{{twit.User.nick}}</div>
      {% if not followerIdList.includes(twit.User.id) and twit.User.id !== user.id %}
      <button class="twit-follow btn"><i class="far fa-user"></i></button>
      {% elif twit.User.id !== user.id%}
      <button class="twit-unfollow btn"><i class="fas fa-user"></i></button>
      {% endif %}
  
      <button class="like"><i class="far fa-heart"></i></button>
  
      <button class="unlike"><i class="fas fa-heart"></i></button>
  
      <div class="twit-img">
        <a href="/clubdetail">
          <img style="width: 100px" src="{{twit.img}}" alt="섬네일"/>
        </a>
      </div>
    </div>
  </div>
  {% endfor %}
</section>
{% endblock %} 
{% block script %}
<script src="/club/javascripts/clublike.js"></script>
<script>
  //팔로우
  document.querySelectorAll(".twit-follow").forEach(function (tag) {
    tag.addEventListener("click", function () {
      const myId = document.querySelector("#my-id");
      if (myId) {
        const userId = tag.parentNode.querySelector(".twit-user-id").value;
        if (userId !== myId.value) {
          if (confirm("팔로잉하시겠습니까?")) {
            axios
              .post(`/user/${userId}/follow`)
              .then(() => {
                location.reload();
              })
              .catch((err) => {
                console.error(nperr);
              });
          }
        }
      }
    });
  });
  //팔로우끊기
  document.querySelectorAll(".twit-unfollow").forEach(function (tag) {
    tag.addEventListener("click", function () {
      const myId = document.querySelector("#my-id");
      if (myId) {
        const userId = tag.parentNode.querySelector(".twit-user-id").value;
        if (userId !== myId.value) {
          if (confirm("팔로잉끊으시겠습니까?")) {
            axios
              .post(`/user/${userId}/unfollow`)
              .then(() => {
                location.reload();
              })
              .catch((err) => {
                console.error(err);
              });
          }
        }
      }
    });
  });
</script>

{% endblock %}
